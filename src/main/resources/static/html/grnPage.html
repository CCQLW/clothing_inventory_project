<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>入库管理</title>
    <link rel="stylesheet" href="../bootstrap-4.6.1-dist/css/bootstrap.css">
    <script src="../js/jquery.min.js"></script>
    <link rel="Stylesheet " href="../css/bootstrap.css">
    <script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body>
<header>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <form class="navbar-form navbar-left">
                    <div class="form-group">
                        单据编号：
                        <input type="text" class="form-control" placeholder="单据编号">
                    </div>
                    <div class="form-group">
                        所入仓库：
                        <input type="text" class="form-control" placeholder="所入仓库">
                    </div>
                    <div class="form-group">
                        经办人：
                        <input type="text" class="form-control" placeholder="经办人">
                    </div>
                    <div class="form-group">
                        来源：
                        <input type="text" class="form-control" placeholder="来源">
                    </div>
                    <button type="submit" class="btn btn-default">搜索</button>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#myModal">
                            新增
                        </button>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
</header>
<!--保存 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="warehouse" class="control-label" style="color: black">所入仓库 : </label>
                        <input id="warehouse" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="agent" class="control-label" style="color: black">经办人 : </label>
                        <input id="agent" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="source" class="control-label" style="color: black">来源 : </label>
                        <input id="source" type="text" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id = "save">保存</button>
            </div>
        </div>
    </div>
</div>
<!--修改 -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <div style="display:none">
                            <textarea id="uid" type="text" class="form-control" ></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="uwarehouse" class="control-label" style="color: black">所入仓库 : </label>
                        <input id="uwarehouse" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="uagent" class="control-label" style="color: black">经办人 : </label>
                        <input id="uagent" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="usource" class="control-label" style="color: black">来源 : </label>
                        <input id="usource" type="text" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id = "update">保存</button>
            </div>
        </div>
    </div>
</div>
<table class="table table-striped table-bordered">
    <thead>
    <tr>
        <th scope="col">序号</th>
        <th scope="col">单据编号</th>
        <th scope="col">所入仓库</th>
        <th scope="col">入库时间</th>
        <th scope="col">经办人</th>
        <th scope="col">来源</th>
        <th scope="col">操作</th>
    </tr>
    </thead>
    <tbody id="tbody">
    </tbody>
</table>

<nav aria-label="Page navigation example" style="float: right">
    <ul class="pagination">
        <li class="page-item" id="pre">
            <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        <!--        <li class="page-item"><a class="page-link" href="#" onclick="page(1,10)" id="page1">1</a></li>-->
        <!--        <li class="page-item"><a class="page-link" href="#" onclick="page(2,5)" id="page2">2</a></li>-->
        <li class="page-item" id="next">
            <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>

<!--<div class="position-fixed bottom-0 right-0 p-3" style="z-index: 5; right: 0; bottom: 0;">-->
<!--    &lt;!&ndash;    class hide改成show 显示&ndash;&gt;-->
<!--    <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true" data-delay="2000">-->
<!--        <div class="toast-header">-->
<!--            <img src="..." class="rounded mr-2" alt="...">-->
<!--            <strong class="mr-auto">Bootstrap</strong>-->
<!--            <small>11 mins ago</small>-->
<!--            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">-->
<!--                <span aria-hidden="true">&times;</span>-->
<!--            </button>-->
<!--        </div>-->
<!--        <div class="toast-body">-->
<!--            Hello, world! This is a toast message.-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<script>


    function page(page, size) {
        var other;
        $.get({
            url: "/grn/getPage",
            data: {
                page: page,
                size: size
            },
            success: function (data) {
                if (data.code === 20041) {
                    var html = "";
                    var d = data.data.records;
                    other = data.data;
                    for (var i = 0; i < d.length; i++) {
                        html += "<tr>";
                        html += "<td>" + (i + 1) + "</td>";
                        // html += "<td>" + d[i].receiptNumber + "</td>";
                        html += "<td><a class=\"btn btn-primary btn-lg active\" role=\"button\" " + "id=" + d[i].grnId + ">" + d[i].receiptNumber + "</a></td>";
                        html += "<td>" + d[i].warehouse + "</td>";
                        html += "<td>" + fmtDateTime(d[i].storageTime) + "</td>";
                        html += "<td>" + d[i].agent + "</td>";
                        html += "<td>" + d[i].source + "</td>";
                        // html += "<td><button type=\"button\" class=\"btn-danger\" " + "id=" + d[i].id + ">删除</button></td>";
                        html += "<td><button type=\"button\" class=\"btn-info\" data-toggle=\"modal\" data-target=\"#updateModal\""+ "data-whatever=" + d[i].id + ">修改</button>" +
                            "<button type=\"button\" class=\"btn-danger\" "+ "id=" + d[i].id + ">删除</button></td>";
                        html += "</tr>";
                    }
                    $("#tbody").html(html);
                    localStorage.setItem('pages', other.pages);
                    localStorage.setItem('size', other.size);
                    localStorage.setItem('current', other.current);
                    localStorage.setItem('total', other.total);
                }
            }
        });
        // console.log(other);
        // return "other";
    }

    function fmtDateTime(obj) {
        var d = new Date(obj);
        var year = d.getFullYear();
        var month = "0" + (d.getMonth() + 1);
        var day = "0" + d.getDate();
        var time = year + '-' + month.substring(month.length - 2, month.length) + '-' + day.substring(day.length - 2, day.length);
        return time;
    }

    window.onload = function () {
        page(1, 5);
        var pages = localStorage.getItem('pages');
        var size = localStorage.getItem('size');
        // var line = ' <li class="page-item"><a class="page-link" href="#" onclick="page(1,10)" id="page1">1</a></li> ';
        var line = "";
        for (var i = 1; i <= pages; i++) {
            line += '<li class="page-item"><a class="page-link" href="#" onclick="page(' + i + ',' + size + ')" id="page' + i + '">' + i + '</a></li>';
        }
        $("#pre").after(line);
    }
    $("#pre").click(function () {
        var current = localStorage.getItem('current');
        var size = localStorage.getItem('size');
        if (current > 1) {
            current--;
            page(current, size);
        }
    });
    $("#next").click(function () {
        var current = localStorage.getItem('current');
        var size = localStorage.getItem('size');
        var pages = localStorage.getItem('pages');
        if (current < pages) {
            current++;
            page(current, size);
        }
    });
    $("#tbody").on("click", "button", function () {
        var id = $(this).attr("id");
        var cals = $(this).attr("class");
        if(cals === 'btn-danger') {
            // console.log(id);
            $.ajax({
                url: "/grn/delete/" + id, //请求地址
                type: "DELETE", //请求方式
                success: function (data) {
                    if (data.code === 20021) {
                        alert("删除成功");
                        page(1, 5);
                    }
                }
            });
        }
    });
    $("#tbody").on("click", "a", function () {
        var id = $(this).attr("id");
        window.location.href = '../html/warehousingDatailPate.html';
    });
    $("#save").on("click", function () {
        var warehouse = $("#warehouse").val();
        var agent = $("#agent").val();
        var source = $("#source").val();
        if(warehouse === ''||agent ===  ''||source === ''){
            alert('输入不能为空');
            return ;
        }
        $.ajax({
            url: "/grn/save", //请求地址
            type: "POST", //请求方式
            contentType: "application/json",
            data: JSON.stringify({
                warehouse: warehouse,
                agent: agent,
                source: source
            }),
            success: function (data) {
                if (data.code === 20011) {
                    alert("新增成功");
                    page(1, 5);
                }
            }
        });
    });
    $("#update").on("click", function () {
        var warehouse = $("#uwarehouse").val();
        var agent = $("#uagent").val();
        var source = $("#usource").val();
        var id = $("#uid").val();
        if(warehouse === ''&&agent === ''&&source === ''){
            alert("未修改值");
            return;
        }
        // console.log(id);
        $.ajax({
            url: "/grn/update", //请求地址
            type: "PUT", //请求方式
            contentType: "application/json",
            data: JSON.stringify({
                id: id,
                warehouse: warehouse,
                agent: agent,
                source: source
            }),
            success: function (data) {
                if (data.code === 20031) {
                    alert("修改成功");
                    page(1, 5);
                }
            }
        });
    });
    $('#updateModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var id = button.data('whatever');
        var modal = $(this);
        modal.find('.modal-body textarea').val(id);
    })
</script>
</body>
</html>