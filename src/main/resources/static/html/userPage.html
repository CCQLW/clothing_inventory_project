<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
    <link rel="stylesheet" href="../bootstrap-4.6.1-dist/css/bootstrap.css">
    <script src="../js/jquery.min.js"></script>
</head>
<body>
<table class="table table-dark">
    <thead>
    <tr>
        <th scope="col">序号</th>
        <th scope="col">用户名</th>
        <th scope="col">权限</th>
        <th scope="col">操作</th>
    </tr>
    </thead>
    <tbody id="tbody">
    </tbody>
</table>

<nav aria-label="Page navigation example" style="float: right">
    <ul class="pagination">
        <li class="page-item" id="pre">
            <a class="page-link" href="#" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        <!--        <li class="page-item"><a class="page-link" href="#" onclick="page(1,10)" id="page1">1</a></li>-->
        <!--        <li class="page-item"><a class="page-link" href="#" onclick="page(2,5)" id="page2">2</a></li>-->
        <li class="page-item" id="next">
            <a class="page-link" href="#" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>

<script>
    function page(page, size) {
        var other;
        $.get({
            url: "/user/page",
            data: {
                page: page,
                size: size
            },
            success: function (data) {
                // console.log(data);
                if (data.result === "success") {
                    var html = "";
                    var d = data.data.records;
                    other = data.data;
                    for (var i = 0; i < d.length; i++) {
                        html += "<tr>";
                        html += "<td>" + (i + 1) + "</td>";
                        html += "<td>" + d[i].username + "</td>";
                        html += "<td>" + d[i].authority + "</td>";
                        html += "<td><a href='/user/delete?id=" + d[i].id + "'>删除</a></td>";
                        html += "</tr>";
                    }
                    $("#tbody").html(html);
                    localStorage.setItem('pages', other.pages);
                    localStorage.setItem('size', other.size);
                    localStorage.setItem('current', other.current);
                    localStorage.setItem('total', other.total);
                    // localStorage.setItem('other', other);
                }
            }
        });
        // console.log(other);
        // return "other";
    }

    window.onload = function () {
        page(1, 5);
        var pages = localStorage.getItem('pages');
        var size = localStorage.getItem('size');
        // var line = ' <li class="page-item"><a class="page-link" href="#" onclick="page(1,10)" id="page1">1</a></li> ';
        var line = "";
        for (var i = 1; i <= pages; i++) {
            line += '<li class="page-item"><a class="page-link" href="#" onclick="page(' + i + ',' + size + ')" id="page' + i + '">' + i + '</a></li>';
        }
        $("#pre").after(line);
    }
    $("#pre").click(function () {
        var current = localStorage.getItem('current');
        var size = localStorage.getItem('size');
        if (current > 1) {
            current--;
            page(current, size);
        }
    });
    $("#next").click(function () {
        var current = localStorage.getItem('current');
        var size = localStorage.getItem('size');
        var pages = localStorage.getItem('pages');
        if (current < pages) {
            current++;
            page(current, size);
        }
    });
</script>
</body>
</html>